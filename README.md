# quick-cocos2d-lua çƒ­æ›´æ–°æ¨¡å—ä»£ç +é…å¥—è„šæœ¬å·¥å…·

3.0 æ›´æ–°æ—¥å¿—ï¼š

LoadSceneæ›´åä¸ºUpdateScene

æ›´æ–°æ–‡ä»¶å¤§å°æç¤º(downloaded/total)

æ›´æ–°å‰é¢„æ‰§è¡Œé¢å¤–çš„luaä»£ç preupdate/preupdate.lua, å¯å•ç‹¬æ›´æ–°preupdateä»¥é¿å…æ›´æ–°æ•´ä¸ªupdateræ¨¡å—

å®žçŽ°updateræ¨¡å—è‡ªæˆ‘æ›´æ–°

æ›´æ–°æ—¶çš„èƒŒæ™¯å’Œè¿›åº¦æ¡èµ„æºè·¯å¾„ä¸å†å†™å…¥src/config.luaå†…ï¼Œè€Œç›´æŽ¥å†™æ­»åœ¨loader/UpdateScene.luaï¼Œæœ‰å˜æ›´éœ€æ±‚æ—¶åªéœ€æ›´æ–°updateræ¨¡å—å³å¯æˆ–è€…åœ¨preupdate.luaä¸­ç›´æŽ¥å¯¹UpdateSceneä½œè°ƒæ•´ä¿®æ”¹ï¼ˆæŽ¨èåŽè€…ï¼‰

æœ¬é¡¹ç›®åŸºäºŽ[åŸºäºŽ quick-cocos2d-x 3.3 çš„çƒ­æ›´æ–°å°é¡¹ç›®](https://github.com/uhoohei/jw_loader)ä¿®æ”¹è€Œæ¥ï¼Œæ„Ÿè°¢ï¼

## è¦ç‚¹ï¼š
0. åŸºäºŽ[Quick-Cocos2dx-Community](https://github.com/u0u0/Quick-Cocos2dx-Community)3.6.5ç‰ˆæœ¬ï¼Œä¸é€‚ç”¨äºŽ3.7+; Macå¹³å°ä¸‹è¿è¡Œ;
1. æ— éœ€å¯¹å¼•æ“Žè¿›è¡Œæ”¹é€ ï¼Œå°å·§ç®€æ´ï¼Œæ— éœ€å¼ºåŽå°æ”¯æŒï¼Œå¾ˆå¤šçƒ­æ›´æ–°æ–¹æ¡ˆä¸­éƒ½éœ€è¦æ¯”è¾ƒå¼ºçš„åŽç«¯æŽ¥å£é…åˆï¼Œæ­¤æ–¹æ¡ˆåªéœ€è¦å°†é™æ€æ–‡ä»¶ä¸Šä¼ è‡³WEBæœåŠ¡å™¨å³å¯ï¼Œä¸éœ€è¦åŠ¨æ€è¯­è¨€åŽå°çš„æ”¯æŒ
2. é¡¹ç›®æ— éœ€ç‰¹åˆ«çš„ç»“æž„è°ƒæ•´ï¼Œå°†src/main.luaã€src/config.luaã€src/app/const.lua æŒ‰éœ€é…ç½®åŽæ›¿æ¢è¿›å·¥ç¨‹ï¼ŒåŒæ—¶æ”¾å…¥çƒ­æ›´æ‰€éœ€èƒŒæ™¯å’Œè¿›åº¦æ¡ç­‰èµ„æºåˆ°res/updateæ–‡ä»¶å¤¹å³å¯
3. å°†srcæºç ç›®å½•åŠ å¯†åˆ†åŒ…ï¼ˆinit*.zip, updater*.zip, framework64*.zip, game*.zipï¼‰ã€‚init*.zipç”±cppè‡ªåŠ¨åŠ è½½ï¼Œå…¶ä»–ç”±luaåŠ è½½ã€‚game*.zipä¸ºæ¸¸æˆä¸»é€»è¾‘ï¼ˆappæ–‡ä»¶å¤¹ï¼‰
4. è‡ªåŠ¨åˆ¤æ–­æ‰‹æœºcpuä½æ•°ï¼Œé¿å…ä¸‹è½½æ— ç”¨çš„.zip
5. çƒ­æ›´æ¨¡å—åŸºäºŽå¼•æ“ŽåŸºç¡€æ¨¡å—ç¼–å†™ï¼Œæ›´æ–°è¿‡ç¨‹åœ¨ä¸€ä¸ªç‹¬ç«‹çš„sceneä¸­å®Œæˆï¼Œä¸ä¸Žé¡¹ç›®æœ¬èº«ä»£ç æ··åˆ
6. çƒ­æ›´ä¸­ç¨‹åºé€€å‡ºï¼Œå†æ¬¡å¯åŠ¨ä¼šè‡ªåŠ¨åˆ¤æ–­å·²ä¸‹è½½çš„æ–‡ä»¶ï¼ŒèŠ‚çœæµé‡
7. æ”¯æŒå¤šæ–‡ä»¶åŒæ—¶ä¸‹è½½


## ä½¿ç”¨æ­¥éª¤ï¼š
0ã€é…ç½®å¥½src/main.luaã€src/config.luaã€src/app/const.luaä¸­çš„çƒ­æ›´çš„å…³é”®å‚æ•°å¹¶å‡†å¤‡å¥½çƒ­æ›´æ‰€éœ€èµ„æºæ–‡ä»¶å¤¹res/updateåŽï¼Œå°†æ¸¸æˆå·¥ç¨‹çš„srcå’Œresæ‹·è´è‡³æ­¤çƒ­æ›´ç›®å½•ï¼Œå¹¶æŒ‰å¦‚ä¸‹æ­¥éª¤ä¾æ¬¡è¿è¡Œè„šæœ¬1ï¼Œ2ï¼Œ3

1ã€updater_build.sh å¯é€‰å‚æ•°ï¼šæ¸¸æˆå·¥ç¨‹è·¯å¾„ï¼ˆé»˜è®¤ä¸ºè¯¥è„šæœ¬æ‰€åœ¨ä½ç½®ï¼‰

ç”¨é€”ï¼šç¼–è¯‘çƒ­æ›´æ–°æ¨¡å—â€œhotupdateræ–‡ä»¶å¤¹+preupdateæ–‡ä»¶å¤¹â€çš„luaä»£ç ä¸ºupdater32.zipå’Œupdater64.zipï¼Œå¹¶æ”¾åˆ°æ¸¸æˆå·¥ç¨‹çš„res/ä¸‹ï¼ˆç§‰æ‰¿å¼€æºç²¾ç¥žï¼Œçº¯æ‰“åŒ…ä¸åŠ å¯†ï¼‰

æ³¨æ„ï¼š

loader/UpdateSceneåœºæ™¯ï¼Œå®žçŽ°è¿›åº¦æ¡åŠŸèƒ½ï¼Œè¯·æå‰å°†æ‰€éœ€èµ„æºæ”¾å…¥updateæ–‡ä»¶å¤¹å¹¶æŒ‰éœ€å‘½å

å•ä¸ªZIPåŒ…ï¼Œæ£€æµ‹å’Œä¸‹è½½æ›´æ–°æ–‡ä»¶æ‰€éœ€çš„luaåº“å‡å·²å†…ç½®ï¼Œä¸ä¸Žé¡¹ç›®æœ¬èº«ä»£ç äº§ç”Ÿè€¦åˆï¼›

çŽ°åœ¨è¿™ä¸ªå‡çº§æ¨¡å—æœ¬èº«ä¹Ÿå¯ä»¥è¢«æ›´æ–°ï¼ˆä¸ºupdater**.zipå•ç‹¬è®¾ç½®ä¸€ä¸ªå›ºå®šçš„æœç´¢ç›®å½•ï¼Œæœ‰æ›´æ–°æ—¶å°±æ›´æ–°åˆ°è¯¥å›ºå®šç›®å½•ï¼‰ï¼Œä¸è¿‡å¦‚æžœä¸æ˜¯è¿«ä¸å¾—å·²ä¸æŽ¨èè¿™ä¹ˆåšï¼Œæ˜¾ç¤ºä¸Šçš„é—®é¢˜å°½é‡é€šè¿‡æ›´æ–°preupdateå®žçŽ°ï¼


2ã€framework_build.sh å¯é€‰å‚æ•°ï¼šæ¸¸æˆå·¥ç¨‹è·¯å¾„ï¼ˆé»˜è®¤ä¸ºè¯¥è„šæœ¬æ‰€åœ¨ä½ç½®ï¼‰

ç”¨é€”ï¼šç¼–è¯‘quickå¼•æ“Žçš„ cocos å’Œ framework ç›®å½•ä¸ºä¸€æ•´ä¸ªres/framework32.zipå’Œres/framework64.zipï¼ˆç§‰æ‰¿å¼€æºç²¾ç¥žï¼Œçº¯æ‰“åŒ…ä¸åŠ å¯†ï¼‰

æ³¨æ„ï¼šæ˜¯é€šè¿‡ cocos å’Œ framework æ”¾å…¥æŸä¸ªä¸´æ—¶ç›®å½•åŽå†è¿›è¡Œæ‰“åŒ…çš„æ–¹å¼


3ã€game_build.sh r|t(æ­£å¼ï½œæµ‹è¯•çŽ¯å¢ƒæ ‡è¯† ä¸ºå¿…é¡»å‚æ•°)

ç”¨é€”ï¼šç¼–è¯‘åŠ å¯†æ¸¸æˆä»£ç å’Œèµ„æºï¼Œç”Ÿæˆæ‰“åŒ…æ–‡ä»¶å’Œçƒ­æ›´æ–‡ä»¶

æ­¥éª¤ï¼š

1ï¼‰ã€ç¼–è¯‘å¹¶åŠ å¯†srcæºç ï¼ˆæ¸¸æˆä¸»é€»è¾‘ï¼‰ä¸ºgame32.zipå’Œgame64.zipåŽæ”¾å…¥.dataç›®å½•å†… ï¼ˆåˆ«å¿˜è®¾ç½®ç­¾å-eså’Œå¯†ç -ekï¼Œéœ€ä¸ŽClasses/AppDelegate.cppä¸­çš„ç­¾åå¯†ç ä¿æŒä¸€è‡´ï¼‰

2ï¼‰ã€è°ƒç”¨init_build.shç¼–è¯‘å¹¶åŠ å¯†ï¼ˆAppä¸­æœ€å…ˆè¢«æ‰§è¡Œçš„luaä»£ç ï¼‰ä¸ºinit32.zipå’Œinit64.zipï¼Œæ”¾å…¥.dataç›®å½•

3ï¼‰ã€åˆ›å»ºbuildç›®å½•ï¼ˆç”¨äºŽå‘å¸ƒåº”ç”¨åŒ…ï¼‰

4ï¼‰ã€python encrypt_res.py åŠ å¯†res/ä¸‹çš„å›¾ç‰‡èµ„æºå¹¶æ”¾å…¥ï¼ˆåŒ…æ‹¬ä¹‹å‰æ”¾å…¥çš„updater*.zipå’Œframework*.zipï¼‰build/resç›®å½•

5ï¼‰ã€å¤åˆ¶æ‰€æœ‰.dataç›®å½•ä¸‹çš„.zipæ–‡ä»¶åˆ°build/resä¸‹

6ï¼‰ã€python make_update_files.py $1 ç”Ÿæˆæœ€ç»ˆçš„çƒ­æ›´æ–°æ–‡ä»¶å¤¹ï¼ˆä»¥src/main.luaé‡Œçš„GAME_IDå‘½åï¼‰æ”¾å…¥update_buildä¸‹

æ³¨æ„ï¼š

å°†srcä¸‹çš„æ–‡ä»¶å¤¹ï¼ˆappæ–‡ä»¶å¤¹ç­‰ï¼‰æ‹·è´åˆ°ä¸´æ—¶ç›®å½•æ‰“åŒ…çš„æ–¹å¼ä»¥å±è”½å†—ä½™æ–‡ä»¶ä¸€èµ·æ‰“åŒ…è¿›game

tæµ‹è¯•è¡¨ç¤ºç”Ÿæˆæ›´æ–°æ–‡ä»¶å…ˆå†…éƒ¨æµ‹è¯•æ˜¯å¦æ­£å¸¸ï¼Œç¡®è®¤ä¸€åˆ‡æ­£å¸¸åŽå†ä»¥ræ–¹å¼è¿è¡Œå°†æ–‡ä»¶release

å­˜æ”¾çƒ­æ›´æ–°æ–‡ä»¶çš„æœåŠ¡å™¨URLåœ¨make_update_files.pyå†…è®¾ç½®


3.1ã€init_build.sh ï¼ˆåˆ«å¿˜è®¾ç½®ç­¾å-eså’Œå¯†ç -ekï¼‰

ç”¨é€”ï¼š
ç¼–è¯‘å¹¶åŠ å¯†luaåˆå§‹åŒ–æ–‡ä»¶srcæ ¹ç›®å½•ä¸‹çš„luaæ–‡ä»¶(ä¸»è¦æ˜¯main.luaã€config.lua)ä¸ºinit32.zipå’Œinit64.zipï¼Œæ”¾å…¥.dataç›®å½•

æ³¨æ„ï¼šé€šè¿‡å°†srcæ ¹ç›®å½•ä¸‹çš„luaæ–‡ä»¶æ‹·è´è‡³.data/srcç›®å½•ä¸‹å†æ‰“åŒ…çš„æ–¹å¼

3.2ã€encrypt_res.py å¿…é¡»å‚æ•°ï¼š åŠ å¯†ç­¾å-eså’Œå¯†ç -ek

ç”¨é€”ï¼šå°†èµ„æºåŠ å¯†åŽæ”¾å…¥build/resç›®å½•

æ³¨æ„ï¼šå¯è®¾ç½®ä¸è¦åŠ å¯†çš„æ–‡ä»¶list

3.3ã€make_update_files.py å¿…é¡»å‚æ•° r|t(æ­£å¼ï½œæµ‹è¯•çŽ¯å¢ƒæ ‡è¯†)

ç”¨é€”ï¼š
ç”Ÿæˆæ£€æµ‹çƒ­æ›´æ–‡ä»¶æ‰€éœ€è¦çš„ç´¢å¼•æ–‡ä»¶ï¼ŒåŒæ—¶åœ¨ç›®å½•update_buildä¸‹ç”Ÿæˆæ‰€æœ‰çƒ­æ›´MD5å½¢å¼çš„æ–‡ä»¶

æ­¥éª¤ï¼š

1ï¼‰è®¡ç®—build/resç›®å½•ä¸‹æ‰€æœ‰åŠ å¯†åŽçš„æ–‡ä»¶çš„æŒ‡çº¹(md5)ï¼ŒåŒæ—¶å°†èµ„æºæ‹·è´è‡³update_build/resources/æ ¹ç›®å½•ä¸‹å¹¶ä»¥å®ƒè‡ªå·±çš„md5é‡å‘½å

2ï¼‰å°†æ‰€æœ‰èµ„æºæ–‡ä»¶ä»¥ â€œåç§°:[å¤§å°ï¼Œmd5]â€ çš„æ ¼å¼å†™å…¥ç´¢å¼•æ–‡ä»¶update_build/resindex.txtï¼ˆå¹¶æ‹·è´ä¸€ä»½åˆ°build/resä¸‹ï¼‰

3ï¼‰å°†ç‰ˆæœ¬ä¿¡æ¯VERSION_NAME GAME_ID BRANCH_ID SCRIPT_VERSIONç­‰å†™å…¥update_build/version.txtï¼ˆåŒ…æ‹¬resindex.txtçš„md5ï¼‰

æ³¨æ„ï¼š
å®žé™…ç”Ÿäº§çŽ¯å¢ƒä¸‹å¯èƒ½ä¼šå—åˆ°è¿è¥å•†ç½‘ç»œé™åˆ¶ï¼Œå®‰å“æ‰‹æœºä½¿ç”¨æ•°æ®æµé‡æ–¹å¼è®¿é—®ç½‘ç»œæ—¶ï¼Œä»Žé˜¿é‡Œäº‘ä¸Šä¸‹è½½version.txtæ€»æ˜¯è¦è€—æ—¶20sï¼Œå¯é€šè¿‡å°†çƒ­æ›´æ–°æœåŠ¡å™¨çš„URLè®¾ç½®CDNåŠ é€Ÿçš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜

## çƒ­æ›´çš„å…³é”®å‚æ•°è¯´æ˜Ž

### æ¸¸æˆIDï¼Œä¸åŒçš„æ¸¸æˆä»¥æ­¤ä½œä¸ºåŒºåˆ«
æ–‡ä»¶ï¼šsrc/config.lua
å˜é‡åï¼šGAME_ID
è¢« make_update_files.py æ‰€è¯»å–

### ä¸»ç‰ˆæœ¬å·
æ–‡ä»¶ï¼šsrc/config.lua
å˜é‡åï¼šVERSION_HOST
è‡ªå®šä¹‰ä¸»ç‰ˆæœ¬å·ï¼ˆåªå–ç¬¬ä¸€ä½æ•´æ•°ï¼Œå¯ä¸ŽAndroidå’ŒiOSæ‰“åŒ…ç¼–è¯‘çš„ä¸»ç‰ˆæœ¬å·å¯¹åº”å®šä¹‰ï¼‰ï¼Œå®ƒåŒæ—¶ä¹Ÿéœ€è¦è¢« make_update_files.py æ‰€è¯»å–ï¼Œçƒ­æ›´æ—¶ä¼šåˆ¤æ–­æ­¤å€¼ï¼Œä¸€èˆ¬å¤§ç‰ˆæœ¬å·åªæœ‰åœ¨é¡¹ç›®ä¾èµ–çš„æ¸¸æˆå¼•æ“Žæˆ–é¡¹ç›®åŽŸç”Ÿä»£ç å±‚ï¼ˆOC,javaï¼ŒæŽ¥å…¥ç¬¬ä¸‰æ–¹SDKï¼‰å˜æ›´æ—¶æ‰å˜æ›´

### åˆ†æ”¯ID
æ–‡ä»¶ï¼šsrc/config.lua
å˜é‡åï¼šBRANCH_ID å­—ç¬¦ä¸²
åˆ†æ”¯IDçš„å®šä¹‰å’Œä½œç”¨æ˜¯ä¸ºäº†åŒºåˆ«ä¸åŒçš„ç¬¬ä¸‰æ–¹å¹³å°æˆ–SDKï¼Œæœ‰æ—¶å€™ä¸ºäº†å‘å¸ƒæŸäº›æ¸ é“ï¼Œå¯èƒ½è¦æŽ¥å…¥ä»–ä»¬çš„SDKï¼Œè¿™æ ·çš„è¯ä»–ä»¬çš„ä»£ç ä¸Žä¸»åˆ†æ”¯å¯èƒ½ç¨æœ‰ä¸åŒï¼Œæ­¤æ—¶ä¸ºäº†åŒºåˆ«æ›´æ–°ï¼Œå¼•å…¥äº†åˆ†æ”¯IDçš„æ¦‚å¿µ

### è„šæœ¬ç‰ˆæœ¬ID
æ–‡ä»¶ï¼šsrc/app/const.lua æˆ–è€… src/app/init.lua
å˜é‡åï¼šSCRIPT_VERSION_ID æ•´æ•°
è„šæœ¬ç‰ˆæœ¬IDæ˜¯å”¯ä¸€ç”¨æ¥æ¯”è¾ƒåˆ¤æ–­æ˜¯å¦æœ‰æ–°ç‰ˆæœ¬çš„å˜é‡ï¼Œå½“çº¿ä¸Šç‰ˆæœ¬å¤§äºŽæœ¬åœ°ç‰ˆæœ¬æ—¶ï¼Œæ‰æœ‰åŽç»­çš„çƒ­æ›´æµç¨‹ï¼Œ
***æ¯ä¸€æ¬¡å‘å¸ƒçƒ­æ›´ç‰ˆæœ¬éƒ½å¿…é¡»æ”¹å˜æ­¤å€¼å¹¶ç”¨çƒ­æ›´çš„æ‰“åŒ…è„šæœ¬è¿›è¡Œç¼–è¯‘***

### è·¨ä¸»ç‰ˆæœ¬æ›´æ–°
æ–‡ä»¶ï¼šsrc/app/mainVersionUpdate.lua
è·¨ä¸»ç‰ˆæœ¬æ›´æ–°å‚è€ƒä»£ç ï¼Œå°†å…¶æ”¾åœ¨æ¸¸æˆå…¥å£å¤„ï¼Œä½œä¸ºæ–°ç‰ˆæ›´æ–°ä»£ç æŽ¨é€ç»™ç”¨æˆ·ï¼Œæé†’ç”¨æˆ·ä¸‹è½½æ–°ç‰ˆæœ¬ã€‚


### UPDATE_PATH
æ–‡ä»¶ï¼šsrc/main.lua
æ›´æ–°çš„å·¥ä½œè·¯å¾„

### GAME_ENTRANCE
æ–‡ä»¶ï¼šsrc/main.lua
æ¸¸æˆçš„çœŸæ­£å…¥å£ï¼Œçƒ­æ›´å®ŒæˆåŽä¼šåŠ è½½æ­¤å…¥å£æ–‡ä»¶å¹¶newå‡ºæ¥è¿›è¡ŒçœŸæ­£çš„è¿›å…¥æ¸¸æˆçš„è¿‡ç¨‹


### çƒ­æ›´èƒŒæ™¯åŠè¿›åº¦æ¡èµ„æºè·¯å¾„
æ–‡ä»¶ï¼šloader/UpdateScene.lua
èµ„æºè·¯å¾„åœ¨RESè¡¨ä¸­æŒ‡å®šï¼ˆæ‹·è´å·²ä¸‹è½½æ–‡ä»¶è¿›åº¦æ¡è·¯å¾„åœ¨COPYä¸­æŒ‡å®šï¼‰ï¼Œç»Ÿä¸€æ”¾åœ¨ä»Žå·¥ç¨‹ç›®å½•res/updateç›®å½•ä¸‹ï¼Œä¹Ÿå¯é€šè¿‡çƒ­æ›´æ–°æ›¿æ¢ï¼ˆä¸è¿‡è¦ä¸‹æ¬¡ç”Ÿæ•ˆï¼‰

æ³¨æ„ï¼šæ‰€æœ‰èµ„æºéžå¿…é¡»ï¼Œæœ€ä½Žé…ç½®ä¸ºscene.png,update_progress_bg.pngï¼Œupdate_progress.png

## çƒ­æ›´çš„æµç¨‹
ä¸€èˆ¬framework_build.shä¸Župdater_build.shåœ¨æ²¡æœ‰æ–°çš„å˜æ›´çš„æ—¶å€™ä¸éœ€è¦æ¯æ¬¡éƒ½ç¼–è¯‘ã€‚
æ¸¸æˆå‘å¸ƒåŽï¼Œå¹³æ—¶çƒ­æ›´åªéœ€æ‰§è¡Œå·¥ç¨‹æ ¹ç›®å½•ä¸‹çš„ game_build.sh [r|t], å°†æ‰€ç”Ÿæˆçš„ update_build ç›®å½•ä¸‹ä»¥GAME_IDå‘½åçš„æ–‡ä»¶å¤¹ä¼ åˆ°çƒ­æ›´æ–°æœåŠ¡å™¨(é€šå¸¸å·¥ç¨‹æ–‡ä»¶ä¼šæ¯”è¾ƒå¤šä¼ è¾“éœ€è¦æ—¶é—´ï¼Œæœ€å¥½å…ˆä¸Šä¼ åˆ°ä¸´æ—¶ç›®å½•åŽå†ä¸€æ¬¡ç§»åŠ¨åˆ°æŒ‡å®šç›®å½•ï¼‰

## ä¿®æ”¹å·¥ç¨‹å…¥å£ä»¥æ”¯æŒåŠ å¯†åŠ è½½
ä¿®æ”¹å·¥ç¨‹æ–‡ä»¶ Classes/AppDelegate.cppï¼Œæˆ‘çš„3.6.5æ˜¯ä»Ž93è¡Œå¼€å§‹ï¼Œä»¥æ”¯æŒèµ„æºå’Œä»£ç çš„åŠ å¯†
**è¯·ä¿®æ”¹ä¸‹åˆ—SET_YOUR_PWDä¸ºä½ çš„çœŸå®žé¡¹ç›®å¯†ç **
å½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¸ä¿®æ”¹ï¼Œé‚£æ ·ä½ éœ€è¦åŽ»æŽ‰æ‰€æœ‰è„šæœ¬ä¸­çš„ä¸ŽåŠ å¯†ç›¸å…³çš„é…ç½®é€‰é¡¹
```c++
    FileUtils::getInstance()->setResourceEncryptKeyAndSign("SET_YOUR_PWD", "YOUR_SIGN");
#if 1
    // use luajit bytecode package
    stack->setXXTEAKeyAndSign("SET_YOUR_PWD", "YOUR_SIGN");
    
#ifdef CC_TARGET_OS_IPHONE
    if (sizeof(long) == 4) {
        stack->loadChunksFromZIP("res/init32.zip");
    } else {
        stack->loadChunksFromZIP("res/init64.zip");
    }
#else
    // android, mac, win32, etc
    stack->loadChunksFromZIP("res/init32.zip");
#endif
    stack->executeString("require 'main'");
#else // #if 0
    // use discrete files
    engine->executeScriptFile("src/main.lua");
#endif
```
